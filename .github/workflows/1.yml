name: docker_build_push_acr

on:
  push:
    branches:
      - main

jobs:
  docker_build_push_acr:
    name: 'Docker Build and Push to ACR'
    runs-on: ubuntu-latest
    environment: production

    # Use the Bash shell regardless whether the GitHub Actions runner is ubuntu-latest, macos-latest, or windows-latest
    defaults:
      run:
        shell: bash

    steps:
      # Checkout the repository to the GitHub Actions runner
      - name: Checkout
        uses: actions/checkout@v2

      - name: 'Docker Login'
        uses: azure/login@v1
        with:
          creds: |
            {
              "clientId": "$f2ab5c50-3240-47c4-ace2-8e3d041737b5",
              "clientSecret": "EQE8Q~x2ptqWn6BDc.9UBZQCRaq8pnHXKGtF5ded",
              "subscriptionId": "efa611db-cd08-4b59-8976-3cf7ea377f26",
              "tenantId": "c39c12fd-a237-4330-962b-8904a853a473"
            }
      - run: |
           az webapp list --query "[?state=='Running']"
